version: "3.5"

# Define a custom bridge network named 'app-net'
networks:
  app-net:
    driver: bridge

# Define services (containers)
services:
  # PostgreSQL Database Service
  pg_database:
    container_name: pg_database
    restart: always
    image: postgres
    environment:
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres
    ports:
      - "5432:5432"
    volumes:
      - ./.docker/postgres:/docker-entrypoint-initdb.d # Mount a volume for database initialization scripts
    networks:
      - app-net # Connect the service to the 'app-net' network

  # Backend Service
  back_end:
    container_name: back_end
    restart: always
    build:
      context: ./backend # Specify the build context for the backend Dockerfile
      dockerfile: Dockerfile # Specify the Dockerfile for building the backend
    environment:
      DATABASE_URL: "postgresql://postgres:postgres@pg_database:5432"
    ports:
      - "3001:3001"
    depends_on:
      - pg_database # Depend on the 'db' service, wait for it to be ready before starting
    networks:
      - app-net # Connect the service to the 'app-net' network
